{"version":3,"sources":["../src/js/bundle.js"],"names":["angular","module","value","document","run","$inject","$rootScope","$window","isMobile","msgService","index","styleSheets","styleSheet","rules","i","length","selectorText","match","deleteRule","ex","addEventListener","unsubscribe","config","$routeProvider","$cookiesProvider","toastrConfig","when","templateUrl","controller","resolve","access","otherwise","redirectTo","extend","newestOnTop","maxOpened","target","defaults","expires","$location","$q","store","onChangeError","$on","event","current","previous","rejection","path","getUser","uuid","reject","EstimateController","$scope","$timeout","toastr","undoTimeout","selected","undoEnabled","settings","undo","values","listen","applyChangesAsync","reset","saveSettings","onRemoved","listenPresence","onUserLeft","send","type","message","selectCard","selectedValue","cancel","isSelected","data","hostUuid","warning","leaveChannel","$apply","LoginController","$cookies","_","states","isLoading","state","SELECT_MODE","title","defaultSettings","getSettings","getSettingsFromCookie","setUser","name","channel","isHost","subscribe","onUserChanged","changeState","newState","userName","channels","CREATE_CHANNEL","get","SETTINGS","JOIN_CHANNEL","loadChannels","back","callback","noop","hereNow","status","keys","createChannel","trim","info","includes","error","success","put","joinChannel","saveSettingsToCookie","JSON","stringify","loadDefaultSettings","forIn","key","copy","setSettings","settingsString","parse","user","init","MainController","hasChannel","ResultController","canUndo","flip","selectedCard","cards","checkStatsAsync","onUserPicked","onUserJoined","onUserUndo","forEach","card","_card","removeSelectedCard","find","pull","checkStats","findCardByUuid","remove","showName","sendSettingsToUser","push","resetFor","done","every","settingsToSend","reduce","result","$evalAsync","factory","pubNub","listeners","PubNub","generateUUID","publishKey","subscribeKey","withPresence","removeListener","publish","listener","addListener","actions","presence","action","uuids","subscriptions","animation","color","$watchCollection","newVal","oldVal","originalCallback","subscription","merge"],"mappings":"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","file":"bundle.js","sourcesContent":["(function() {\r\n    'use strict';\r\n\r\n    /**\r\n     * \r\n     * Story point task estimator\r\n     * Made with PubNub: no backend required\r\n     * It might work in IE, but i dont care about it. Use it with Chrome.\r\n     * Because of the limitations of the PubNub's free package (100 UUID/day), the application wont work with 2 clients in the same browser.\r\n     * \r\n     * @author Daniel Biro\r\n     * \r\n     */\r\n    angular\r\n        .module('estimate', [\r\n            'ngRoute',\r\n            'ngCookies',\r\n            'ngAnimate',\r\n            'ngLodash',\r\n            'toastr'\r\n        ])\r\n        .value('isMobile', (function() { return 'ontouchstart' in document; })())\r\n        .run(run);\r\n    \r\n    run.$inject = [\"$rootScope\", \"$window\", \"isMobile\", \"msgService\"];\r\n\r\n    function run($rootScope, $window, isMobile, msgService) {\r\n        $rootScope.isMobile = isMobile;\r\n\r\n        // Remove :hover and :active css rules on touch devices\r\n        if (isMobile) {\r\n            try { // prevent exception on browsers not supporting DOM styleSheets properly\r\n                for (var index in document.styleSheets) {\r\n                    var styleSheet = document.styleSheets[index];\r\n\r\n                    if (!styleSheet.rules) {\r\n                        continue;\r\n                    }\r\n\r\n                    for (var i = styleSheet.rules.length - 1; i >= 0; i--) {\r\n                        if (!styleSheet.rules[i].selectorText) continue;\r\n\r\n                        if (styleSheet.rules[i].selectorText.match(':hover') || styleSheet.rules[i].selectorText.match(':active')) {\r\n                            styleSheet.deleteRule(i);\r\n                        }\r\n                    }\r\n                }\r\n            } catch (ex) {}\r\n        }\r\n\r\n        // Unsubscribe on page unload\r\n        $window.addEventListener(\"beforeunload\", function() {\r\n            msgService.unsubscribe();\r\n        });\r\n    }\r\n\r\n})();;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .config(config);\r\n\r\n    config.$inject = ['$routeProvider', '$cookiesProvider', 'toastrConfig'];\r\n\r\n    function config ($routeProvider, $cookiesProvider, toastrConfig) {\r\n        // Routes config\r\n        $routeProvider\r\n            .when('/login', {\r\n                templateUrl: '/src/templates/login.html',\r\n                controller: 'LoginController'\r\n            })\r\n            .when('/results', {\r\n                templateUrl: '/src/templates/result.html',\r\n                controller: 'ResultController',\r\n                resolve: {\r\n                    access: ['$rootScope', '$location', '$q', 'store', access]\r\n                }\r\n            })\r\n            .when('/estimate', {\r\n                templateUrl: '/src/templates/estimate.html',\r\n                controller: 'EstimateController',\r\n                resolve: {\r\n                    access: ['$rootScope', '$location', '$q', 'store', access]\r\n                }\r\n            })\r\n            .otherwise({\r\n                redirectTo: '/login'\r\n            });\r\n\r\n        // Toastr config\r\n        angular.extend(toastrConfig, {\r\n            newestOnTop: true,\r\n            maxOpened: 6,\r\n            target: 'body'\r\n        });\r\n\r\n        // Cookie config\r\n        $cookiesProvider.defaults.expires = \"2030-12-30T12:00:00.000Z\"\r\n        \r\n        // This function gets called before the navigation happens\r\n        // If a resolve function like this returns a rejected promise, a $routeChangeError will be emitted on the $rootScope\r\n        // We listen once to the $routeChangeError and redirect the page to \"/\"\r\n        function access ($rootScope, $location, $q, store) {\r\n            var onChangeError = $rootScope.$on(\"$routeChangeError\", function (event, current, previous, rejection) {\r\n                $location.path('/');\r\n\r\n                onChangeError();\r\n            });\r\n\r\n            return store.getUser().uuid ? true : $q.reject();\r\n        }\r\n    }\r\n\r\n}());\r\n;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .controller('EstimateController', EstimateController);\r\n\r\n    EstimateController.$inject = ['$rootScope', '$scope', '$timeout', 'toastr', 'store', 'msgService'];\r\n\r\n    function EstimateController ($rootScope, $scope, $timeout, toastr, store, msgService) {\r\n        var undoTimeout;\r\n        $scope.selected = false;\r\n        $scope.undoEnabled = true;\r\n        $scope.settings = {\r\n            undo: true,\r\n            values: []\r\n        };\r\n\r\n        //////////////////////////////////////////////////////////////\r\n\r\n        msgService.listen(\"ANY\", applyChangesAsync);\r\n        msgService.listen(\"RESET\", reset);\r\n        msgService.listen(\"SETTINGS\", saveSettings);\r\n        msgService.listen(\"REMOVE\", onRemoved);\r\n        msgService.listenPresence([\"leave\", \"timeout\"], onUserLeft);\r\n        msgService.listenPresence([\"ANY\"], applyChangesAsync);\r\n        msgService.send({\r\n            type: \"USER_JOINED\",\r\n            message: store.getUser()\r\n        });\r\n\r\n        $scope.selectCard = function(value) {\r\n            if ($scope.selected) {\r\n                return;\r\n            }\r\n\r\n            $scope.selectedValue = value;\r\n            $scope.selected = true;\r\n\r\n            msgService.send({\r\n                type: \"USER_PICKED\",\r\n                message: {\r\n                    value: value,\r\n                    uuid: store.getUser().uuid\r\n                }\r\n            });\r\n\r\n            if ($scope.undoEnabled) {\r\n                undoTimeout = $timeout(function() {\r\n                    if ($scope.selected) {\r\n                        $scope.undoEnabled = false;\r\n                    }\r\n                }, 4000);\r\n            }\r\n        }\r\n\r\n        $scope.undo = function() {\r\n            $timeout.cancel(undoTimeout);\r\n\r\n            msgService.send({\r\n                type: \"USER_UNDO\",\r\n                message: {\r\n                    uuid: store.getUser().uuid\r\n                }\r\n            });\r\n        }\r\n\r\n        $scope.isSelected = function(value) {\r\n            return $scope.selectedValue === value;\r\n        }\r\n\r\n        $scope.$on(\"$destroy\", function() {\r\n            $timeout.cancel(undoTimeout);\r\n        });\r\n\r\n        function reset(data) {\r\n            if (!data.uuid || data.uuid === store.getUser().uuid) {\r\n                $scope.selectedValue = null;\r\n                $scope.selected = false;\r\n                $scope.undoEnabled = $scope.settings.undo;\r\n            }\r\n        }\r\n\r\n        function saveSettings(data) {\r\n            if (data.uuid === store.getUser().uuid) {\r\n                $scope.hostUuid = data.hostUuid;\r\n                $scope.settings = data.settings;\r\n                $scope.undoEnabled = $scope.settings.undo;\r\n            }\r\n        }\r\n\r\n        function onRemoved(data) {\r\n            if (data.uuid === store.getUser().uuid) {\r\n                toastr.warning(\"You have been removed from the channel.\", \"Warning\");\r\n                $scope.leaveChannel();\r\n            }\r\n        }\r\n\r\n        function onUserLeft(data) {\r\n            // The channel host left the channel, time to leave\r\n            if (data.uuid === $scope.hostUuid) {\r\n                toastr.warning(\"Channel host left. Leaving channel.\", \"Warning\");\r\n                $scope.leaveChannel();\r\n            }\r\n        }\r\n\r\n        // Apply is needed because pubNub callbacks are executed from outside of angular's scope\r\n        // Timeout is needed because there is no guarantee that the \"ANY\" callback gets called later than other event callbacks\r\n        function applyChangesAsync() {\r\n            $timeout(function() {\r\n                $scope.$apply();\r\n            });\r\n        }\r\n    }\r\n\r\n}());\r\n;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .controller('LoginController', LoginController);\r\n\r\n    LoginController.$inject = ['$rootScope', '$scope', '$cookies', '$location', 'lodash', 'toastr', 'store', 'msgService'];\r\n\r\n    function LoginController ($rootScope, $scope, $cookies, $location, _, toastr, store, msgService) {\r\n        $scope.states = {\r\n            \"SELECT_MODE\": \"SELECT_MODE\",\r\n            \"CREATE_CHANNEL\": \"CREATE_CHANNEL\",\r\n            \"JOIN_CHANNEL\": \"JOIN_CHANNEL\",\r\n            \"SETTINGS\": \"SETTINGS\"\r\n        };\r\n\r\n        $scope.isLoading = false;\r\n        $scope.state = $scope.states.SELECT_MODE;\r\n        $scope.title = \"Estimation\";\r\n        $scope.defaultSettings = store.getSettings();\r\n        $scope.settings = getSettingsFromCookie() || store.getSettings();\r\n        \r\n        msgService.unsubscribe();\r\n        store.setUser({ name: null, channel: null, isHost: false });\r\n        store.subscribe(\"user\", onUserChanged);\r\n        \r\n        $scope.changeState = function(newState) {\r\n            $scope.state = newState;\r\n\r\n            switch(newState) {\r\n                case $scope.states.SELECT_MODE:\r\n                    $scope.title = \"Estimation\";\r\n                    $scope.channel = \"\";\r\n                    $scope.userName = \"\";\r\n                    $scope.channels = [];\r\n                    break;\r\n\r\n                case $scope.states.CREATE_CHANNEL:\r\n                    $scope.title = \"Create channel\";\r\n                    $scope.channel = $cookies.get(\"channel\") || \"\";\r\n                    break;\r\n\r\n                case $scope.states.SETTINGS:\r\n                    $scope.title = \"Settings\"\r\n                    break;\r\n                \r\n                case $scope.states.JOIN_CHANNEL:\r\n                    $scope.title = \"Join channel\";\r\n                    $scope.userName = $cookies.get(\"username\") || \"\";\r\n                    $scope.loadChannels();\r\n                    break;\r\n            }\r\n        }\r\n\r\n        $scope.back = function() {\r\n            switch($scope.state) {\r\n                case $scope.states.CREATE_CHANNEL:\r\n                case $scope.states.JOIN_CHANNEL:\r\n                default:\r\n                    $scope.changeState($scope.states.SELECT_MODE);\r\n                    break;\r\n\r\n                case $scope.states.SETTINGS:\r\n                    $scope.changeState($scope.states.CREATE_CHANNEL);\r\n                    break;\r\n            }\r\n        }\r\n\r\n        $scope.loadChannels = function(callback) {\r\n            callback = callback || _.noop;\r\n\r\n            $scope.isLoading = true;\r\n            $scope.channels = [];\r\n\r\n            msgService.hereNow(function(status, data) {\r\n                $scope.channels = _.keys(data.channels);\r\n                $scope.isLoading = false;\r\n\r\n                $rootScope.$apply(callback);\r\n            });\r\n        }\r\n\r\n        $scope.createChannel = function(channel) {\r\n            channel = channel.trim();\r\n\r\n            if (channel) {\r\n                toastr.info(\"Checking channel availability...\", \"Info\");\r\n\r\n                $scope.loadChannels(function() {\r\n                    if (_.includes($scope.channels, channel)) {\r\n                        toastr.error(\"Channel '\" + channel + \"' already exists.\", \"Error\");\r\n                        return;\r\n                    }\r\n\r\n                    msgService.subscribe(channel);\r\n                    store.setUser({ name: name, channel: channel });\r\n                    toastr.success(\"Channel '\" + channel + \"' created\", \"Success\");\r\n                    $cookies.put(\"channel\", channel);\r\n                    $location.path(\"/results\");\r\n                });\r\n            } else {\r\n                toastr.error(\"Please add a name to your channel.\", \"Error\");\r\n            }\r\n        }\r\n\r\n        $scope.joinChannel = function(userName, channel) {\r\n            userName = userName.trim();\r\n            channel = channel.trim();\r\n\r\n            if (userName && channel) {\r\n                store.setUser({ channel: channel, name: userName });\r\n                msgService.subscribe(channel);\r\n\r\n                $cookies.put(\"channel\", channel);\r\n                $cookies.put(\"username\", userName);\r\n\r\n                $location.path(\"/estimate\");\r\n            } else {\r\n                toastr.error(\"Please add a username.\", \"Error\");\r\n            }\r\n        }\r\n\r\n        $scope.saveSettingsToCookie = function() {\r\n            $cookies.put(\"settings\", JSON.stringify($scope.settings));\r\n        }\r\n\r\n        $scope.loadDefaultSettings = function() {\r\n            _.forIn($scope.defaultSettings, function(value, key) {\r\n                $scope.settings[key] = angular.copy(value);\r\n            });\r\n        }\r\n\r\n        $scope.$on(\"$destroy\", function() {\r\n            store.setSettings($scope.settings);\r\n            store.unsubscribe(onUserChanged);\r\n        });\r\n\r\n        function getSettingsFromCookie() {\r\n            var settingsString = $cookies.get(\"settings\");\r\n\r\n            return settingsString ? JSON.parse(settingsString) : null;\r\n        }\r\n\r\n        function onUserChanged(user) {\r\n            if (!user.uuid) {\r\n                msgService.init();\r\n            }\r\n        }\r\n    }\r\n\r\n}());\r\n;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .controller('MainController', MainController);\r\n\r\n    MainController.$inject = ['$rootScope', '$scope', '$location', 'store'];\r\n\r\n    function MainController ($rootScope, $scope, $location, store) {\r\n        $scope.user = null;\r\n\r\n        store.subscribe(\"user\", function(user) {\r\n            $scope.user = user;\r\n        });\r\n\r\n        $scope.hasChannel = function() {\r\n            return $scope.user.channel;\r\n        }\r\n\r\n        $scope.leaveChannel = function() {\r\n            $location.path(\"/login\");\r\n        }\r\n\r\n        $scope.isHost = function() {\r\n            return $scope.user.isHost;\r\n        }\r\n    }\r\n\r\n}());\r\n;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .controller('ResultController', ResultController);\r\n\r\n    ResultController.$inject = ['$rootScope', '$scope', '$timeout', 'toastr', 'lodash', 'store', 'msgService'];\r\n\r\n    function ResultController ($rootScope, $scope, $timeout, toastr, _, store, msgService) {\r\n        $scope.settings = store.getSettings();\r\n        $scope.canUndo = $scope.settings.undo;\r\n        $scope.flip = false;\r\n        $scope.selectedCard = null;\r\n        $scope.cards = [];\r\n\r\n        msgService.listen(\"ANY\", checkStatsAsync);\r\n        msgService.listen(\"USER_PICKED\", onUserPicked);\r\n        msgService.listen(\"USER_JOINED\", onUserJoined);\r\n        msgService.listen(\"USER_UNDO\", onUserUndo);\r\n        msgService.listenPresence([\"ANY\"], checkStatsAsync);\r\n        msgService.listenPresence([\"leave\", \"timeout\"], onUserLeft);\r\n\r\n        store.setUser({ isHost: true });\r\n        \r\n        $scope.reset = function() {\r\n            $scope.cards.forEach(function(card) {\r\n                card.value = null;\r\n            });\r\n\r\n            msgService.send({\r\n                type: \"RESET\",\r\n                message: {\r\n                    uuid: null\r\n                }\r\n            });\r\n\r\n            $scope.canUndo = $scope.settings.undo;\r\n            $scope.flip = false;\r\n        }\r\n\r\n        $scope.selectCard = function(card) {\r\n            card.isSelected = !card.isSelected;\r\n\r\n            $scope.cards.forEach(function(_card) {\r\n                if (card !== _card) {\r\n                    card.isSelected = false;\r\n                }\r\n            });\r\n\r\n            $scope.selectedCard = card.isSelected;\r\n        }\r\n\r\n        $scope.removeSelectedCard = function() {\r\n            $scope.selectedCard = null;\r\n\r\n            var card = _.find($scope.cards, \"isSelected\");\r\n\r\n            if (card) {\r\n                msgService.send({\r\n                    type: \"REMOVE\",\r\n                    message: {\r\n                        uuid: card.uuid\r\n                    }\r\n                });\r\n\r\n                _.pull($scope.cards, card);\r\n\r\n                checkStats();\r\n            }\r\n        }\r\n\r\n        function onUserLeft(data) {\r\n            var card = findCardByUuid(data.uuid);\r\n\r\n            if (card) {\r\n                _.remove($scope.cards, function(_card) {\r\n                    return card === _card;\r\n                });\r\n\r\n                toastr.info(\"User \" + card.name + \" left\", \"Info\");\r\n            }\r\n        }\r\n\r\n        function onUserJoined(user) {\r\n            var card = {\r\n                name: $scope.settings.showName ? user.name : \"<hidden>\",\r\n                uuid: user.uuid,\r\n                value: null\r\n            };\r\n\r\n            toastr.info(\"User \" + card.name + \" joined\", \"Info\");\r\n\r\n            sendSettingsToUser(user);\r\n            $scope.cards.push(card);\r\n            $scope.reset();\r\n        }\r\n\r\n        function onUserUndo(data) {\r\n            if ($scope.flip) {\r\n                return;\r\n            }\r\n\r\n            var card = findCardByUuid(data.uuid);\r\n\r\n            if (card) {\r\n                card.value = null;\r\n                $scope.canUndo = true;\r\n                resetFor(card.uuid);\r\n            }\r\n        }\r\n\r\n        function onUserPicked(data) {\r\n            var card = findCardByUuid(data.uuid);\r\n\r\n            if (card) {\r\n                card.value = data.value;\r\n            }\r\n        }\r\n\r\n        function resetFor(uuid) {\r\n            msgService.send({\r\n                type: \"RESET\",\r\n                message: {\r\n                    uuid: uuid\r\n                }\r\n            });\r\n        }\r\n\r\n        function findCardByUuid(uuid) {\r\n            return _.find($scope.cards, { uuid: uuid });\r\n        }\r\n\r\n        function checkStats() {\r\n            var done = _.every($scope.cards, function(card) {\r\n                return card.value !== null;\r\n            });\r\n\r\n            if (done && $scope.cards.length) {\r\n                if ($scope.canUndo) {\r\n                    $scope.canUndo = false;\r\n\r\n                    // Wait extra 3 secs for the last client's possible undo\r\n                    $timeout(checkStats, 3000);\r\n                } else {\r\n                    $scope.flip = true;\r\n                }\r\n            } else {\r\n                $scope.flip = false;\r\n            }\r\n        }\r\n\r\n        function sendSettingsToUser(user) {\r\n            var settingsToSend = angular.copy($scope.settings);\r\n            // Only the accepted values are sent as an array\r\n            settingsToSend.values = _.reduce(settingsToSend.values, function(result, value, key) {\r\n                if (value) {\r\n                    result.push(key);\r\n                }\r\n\r\n                return result;\r\n            }, []);\r\n\r\n            msgService.send({\r\n                type: \"SETTINGS\",\r\n                message: {\r\n                    uuid: user.uuid,\r\n                    hostUuid: store.getUser().uuid,\r\n                    settings: settingsToSend\r\n                }\r\n            });\r\n        }\r\n\r\n        // Angular does not know about pubNub event callbacks\r\n        // We have to initiate a $digest cycle manually by $evalAsync\r\n        function checkStatsAsync() {\r\n            $rootScope.$evalAsync(checkStats);\r\n        }\r\n    }\r\n\r\n}());\r\n;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .factory('msgService', msgService);\r\n\r\n    msgService.$inject = [\"$rootScope\", \"$cookies\", \"store\", \"lodash\"];\r\n\r\n    function msgService ($rootScope, $cookies, store, _) {\r\n        var pubNub = null;\r\n        var listeners = [];\r\n\r\n        return {\r\n            // Init PubNub, set userStore's user uuid\r\n            init: init,\r\n\r\n            // Subscribe for channel\r\n            subscribe: subscribe,\r\n\r\n            // Unsubscribe from channel\r\n            unsubscribe: unsubscribe,\r\n\r\n            // Send message\r\n            send: send,\r\n\r\n            // Listen to messages\r\n            listen: listen,\r\n\r\n            // Listen to presence messages\r\n            listenPresence: listenPresence,\r\n\r\n            // Get all existing channels and connected devices\r\n            hereNow: hereNow\r\n        };\r\n\r\n        function init() {\r\n            var uuid = $cookies.get(\"uuid\");\r\n\r\n            if (!uuid) {\r\n                uuid = PubNub.generateUUID();\r\n                $cookies.put(\"uuid\", uuid);\r\n            }\r\n\r\n            store.setUser({\r\n                uuid: uuid\r\n            });\r\n            \r\n            pubNub = new PubNub({\r\n                publishKey: 'pub-c-69789d50-67b0-4cf4-80b6-368360332773',\r\n                subscribeKey: 'sub-c-82db2fb2-eca4-11e6-889b-02ee2ddab7fe',\r\n                uuid: uuid\r\n            });\r\n        }\r\n\r\n        function subscribe(channel) {\r\n            channel = channel || store.getUser().channel;\r\n\r\n            pubNub.subscribe({\r\n                channels: [channel],\r\n                withPresence: true\r\n            });\r\n        }\r\n\r\n        function unsubscribe(channel) {\r\n            channel = channel || store.getUser().channel;\r\n\r\n            if (pubNub) {\r\n                listeners.forEach(pubNub.removeListener);\r\n                \r\n                pubNub.unsubscribe({\r\n                    channels: [channel]\r\n                });\r\n\r\n                listeners = [];\r\n            }\r\n        }\r\n\r\n        function send(data, channel) {\r\n            channel = channel || store.getUser().channel;\r\n\r\n            pubNub.publish({\r\n                message: data,\r\n                channel: channel\r\n            });\r\n        }\r\n\r\n        function listen(type, callback) {\r\n            var listener = {\r\n                message: function(data) {\r\n                    if (type === \"ANY\") {\r\n                        callback(data.message.message)\r\n                    } else if (data.message.type === type) {\r\n                        callback(data.message.message)\r\n                    }\r\n                }\r\n            }\r\n\r\n            listeners.push(listener);\r\n            pubNub.addListener(listener);\r\n        }\r\n\r\n        function listenPresence(actions, callback) {\r\n            var listener = {\r\n                presence: function(data) {\r\n                    // User will not get his/her own presence messages\r\n                    if (data.uuid === store.getUser().uuid) {\r\n                        return;\r\n                    }\r\n\r\n                    if (_.includes(actions, data.action) || _.includes(actions, \"ANY\")) {\r\n                        callback(data);\r\n                    }\r\n                }\r\n            };\r\n\r\n            listeners.push(listener);\r\n            pubNub.addListener(listener);\r\n        }\r\n\r\n        function hereNow(callback) {\r\n            pubNub.hereNow({ uuids: false }, callback);\r\n        }\r\n    }\r\n\r\n}());;(function () {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('estimate')\r\n        .factory('store', store);\r\n\r\n    store.$inject = [\"$rootScope\", \"lodash\"];\r\n\r\n    function store ($rootScope, _) {\r\n        var subscriptions = []\r\n\r\n        // Default settings\r\n        var store = {\r\n            settings: {\r\n                undo: true,\r\n                showName: true,\r\n                animation: true,\r\n                color: \"#2670e0\",\r\n                values: {\r\n                    0: true, 1: true, 2: true, 3: true, 5: true, 8: true,\r\n                    13: true, 20: true, 40: true, \"∞\": true, \"?\": true\r\n                }\r\n            },\r\n            user: {\r\n                uuid: null,\r\n                name: null,\r\n                channel: null,\r\n                isHost: false\r\n            }\r\n        };\r\n      \r\n        return {\r\n            // Subscribe for store changes\r\n            // Callback gets called with the updated value only (no oldVal as in angular)\r\n            // Callback gets called once immediately after subscribing!\r\n            subscribe: subscribe,\r\n\r\n            // Unsubscribe from store changes\r\n            unsubscribe: unsubscribe,\r\n\r\n            // Returns settings\r\n            getSettings: getSettings,\r\n\r\n            // Set the settings\r\n            setSettings: setSettings,\r\n\r\n            // Sets the user's given properties (other properties will not change!)\r\n            setUser: setUser,\r\n\r\n            // Returns user object\r\n            getUser: getUser\r\n        };\r\n\r\n        function subscribe(key, callback) {\r\n            var unsubscribe = $rootScope.$watchCollection(function() {\r\n                return store[key];\r\n            }, function(newVal, oldVal) {\r\n                callback(newVal);\r\n            }, true);\r\n\r\n            subscriptions.push({\r\n                originalCallback: callback,\r\n                unsubscribe: unsubscribe\r\n            });\r\n        }\r\n\r\n        function unsubscribe(callback) {\r\n            var subscription = _.find(subscriptions, { originalCallback: callback });\r\n            \r\n            if (subscription) {\r\n                subscription.unsubscribe();\r\n\r\n                _.pull(subscriptions, subscription);\r\n            }\r\n        }\r\n\r\n        function getSettings() {\r\n            return angular.copy(store.settings);\r\n        }\r\n\r\n        function getUser() {\r\n            return store.user;\r\n        }\r\n\r\n        function setSettings(settings) {\r\n            store.settings = settings;\r\n        }\r\n\r\n        function setUser(user) {\r\n            angular.merge(store.user, user);\r\n        }\r\n    }\r\n\r\n}());"]}